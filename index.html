<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Center Cost Comparison</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function DataCenterCompare() {
      // Facility size
      const [sizeMW, setSizeMW] = useState(400);

      // Construction costs (per MW)
      const [constructionCostChina, setConstructionCostChina] = useState(6);
      const [constructionCostUS, setConstructionCostUS] = useState(10);

      // PUE (Power Usage Effectiveness) - shared between both countries
      const [pue, setPue] = useState(1.11);

      // Utilization rate
      const [utilization, setUtilization] = useState(60);

      // Arithmetic Intensity for SPFLOPS calculation
      const arithmeticIntensity = 200; // FLOPs per byte

      // Hardware specs
      const hardware = {
        gb200: {
          name: "Nvidia GB200 NVL72",
          powerW: 145000,
          costPerUnit: 2600000,
          memBandwidthTBs: 576, // TB/s
          peakPFLOPS: 180,
        },
        cm384: {
          name: "Huawei CloudMatrix 384",
          powerW: 599821,
          costPerUnit: 8000000,
          memBandwidthTBs: 1229, // TB/s
          peakPFLOPS: 300,
        },
        h200pod: {
          name: "DGX H200 Pod (9 nodes)",
          powerW: 95220, // 9 Ã— (10,200 + 380) per node
          costPerUnit: 2102041, // ~$6.9B / 3,280 pods (includes networking)
          memBandwidthTBs: 345.6, // 9 Ã— 8 Ã— 4.8 TB/s
          peakPFLOPS: 144, // 9 Ã— 8 Ã— 2 PFLOPS
        }
      };

      // Calculate sustainable PFLOPS (memory-limited at AI=200)
      const calcSPFLOPS = (hw) => {
        const memLimited = hw.memBandwidthTBs * arithmeticIntensity / 1000;
        return Math.min(hw.peakPFLOPS, memLimited);
      };

      // Calculate available energy for GPU hardware (after PUE and 48MW overhead)
      const calculateAvailableEnergy = () => {
        return (sizeMW * 1000000 / pue) - 48000000; // 48MW for CPUs/storage
      };

      // Calculate number of racks (rounded down to whole numbers)
      const availableEnergy = calculateAvailableEnergy();
      const racksUS = Math.floor(availableEnergy / hardware.gb200.powerW);
      const racksChina = Math.floor(availableEnergy / hardware.cm384.powerW);
      const podsH200 = Math.floor(availableEnergy / hardware.h200pod.powerW);

      // Calculate costs
      const constructionTotalChina = sizeMW * constructionCostChina * 1000000;
      const constructionTotalUS = sizeMW * constructionCostUS * 1000000;

      const hardwareCostUS = racksUS * hardware.gb200.costPerUnit;
      const hardwareCostChina = racksChina * hardware.cm384.costPerUnit;
      const hardwareCostH200 = podsH200 * hardware.h200pod.costPerUnit;

      // Electricity cost over 3 years
      const utilizationRate = utilization / 100;
      const electricityCostChina = sizeMW * 1000 * utilizationRate * 0.05565 * 8760 * 3;
      const electricityCostUS = sizeMW * 1000 * utilizationRate * 0.0906 * 8760 * 3;

      // Total costs
      const totalCostUS = constructionTotalUS + hardwareCostUS + electricityCostUS;
      const totalCostChina = constructionTotalChina + hardwareCostChina + electricityCostChina;
      const totalCostH200 = constructionTotalChina + hardwareCostH200 + electricityCostChina;

      // Sustainable performance calculations (SPFLOPS)
      const spflopsUS = racksUS * calcSPFLOPS(hardware.gb200);
      const spflopsChina = racksChina * calcSPFLOPS(hardware.cm384);
      const spflopsH200 = podsH200 * calcSPFLOPS(hardware.h200pod);

      // Performance per dollar (SGFLOPS/$)
      const sgflopsPerDollarUS = (spflopsUS * 1000000) / totalCostUS;
      const sgflopsPerDollarChina = (spflopsChina * 1000000) / totalCostChina;
      const sgflopsPerDollarH200 = (spflopsH200 * 1000000) / totalCostH200;

      const formatCurrency = (value) => {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(value);
      };

      const formatNumber = (value) => {
        return new Intl.NumberFormat('en-US', {
          minimumFractionDigits: 0,
          maximumFractionDigits: 2,
        }).format(value);
      };

      const SliderControl = ({ label, value, onChange, min, max, step, unit, icon, suffix = '', benchmarkValue = null, benchmarkLabel = '' }) => (
        <div className="mb-6">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2">
              {icon && <span className="text-gray-600">{icon}</span>}
              <label className="text-sm font-medium text-gray-700">{label}</label>
            </div>
            <span className="text-sm font-bold text-gray-900">{unit}{formatNumber(value)}{suffix}</span>
          </div>
          <div className="relative">
            <input
              type="range"
              min={min}
              max={max}
              step={step}
              value={value}
              onChange={(e) => onChange(parseFloat(e.target.value))}
              className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
            />
            {benchmarkValue !== null && (
              <div
                className="absolute top-0 w-1 h-2 bg-green-600 pointer-events-none"
                style={{ left: `${((benchmarkValue - min) / (max - min)) * 100}%` }}
                title={benchmarkLabel}
              />
            )}
          </div>
          {benchmarkValue !== null && (
            <div className="text-xs text-green-700 mt-1 flex items-center gap-1">
              <span className="inline-block w-3 h-3 bg-green-600 rounded-sm"></span>
              {benchmarkLabel}
            </div>
          )}
        </div>
      );

      const ResultCard = ({ title, construction, hardware, electricity, total, units, unitLabel, spflops, sgflopsPerDollar, color, flag, spflopsPerUnit }) => (
        <div className={`p-6 rounded-lg ${color}`}>
          <h3 className="text-2xl font-bold mb-4">{flag} {title}</h3>

          <div className="mb-4">
            <h4 className="text-sm font-semibold text-gray-600 mb-2">COST BREAKDOWN (3 Years)</h4>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span>Construction:</span>
                <span className="font-semibold">{formatCurrency(construction)}</span>
              </div>
              <div className="flex justify-between">
                <span>Hardware ({formatNumber(units)} {unitLabel}):</span>
                <span className="font-semibold">{formatCurrency(hardware)}</span>
              </div>
              <div className="flex justify-between">
                <span>Electricity (3 years):</span>
                <span className="font-semibold">{formatCurrency(electricity)}</span>
              </div>
            </div>
          </div>

          <div className="pt-4 border-t-2 border-gray-300 mb-4">
            <div className="flex justify-between items-center">
              <span className="text-lg font-bold">Total Cost:</span>
              <span className="text-2xl font-bold">{formatCurrency(total)}</span>
            </div>
          </div>

          <div className="pt-4 border-t-2 border-gray-300 bg-white bg-opacity-40 p-4 rounded">
            <h4 className="text-sm font-semibold text-gray-600 mb-3">SUSTAINABLE PERFORMANCE (AI=200)</h4>
            <div className="space-y-3">
              <div>
                <div className="text-xs text-gray-600">Total Sustainable PFLOPS</div>
                <div className="text-2xl font-bold text-indigo-700">{formatNumber(spflops)} SPFLOPS</div>
                <div className="text-xs text-gray-500">({formatNumber(spflopsPerUnit)} SPFLOPS per unit)</div>
              </div>
              <div>
                <div className="text-xs text-gray-600">Sustainable Efficiency</div>
                <div className="text-2xl font-bold text-green-700">{formatNumber(sgflopsPerDollar)} SGFLOPS/$</div>
              </div>
            </div>
          </div>
        </div>
      );

      // Find the best performer
      const maxSGFLOPS = Math.max(sgflopsPerDollarUS, sgflopsPerDollarChina, sgflopsPerDollarH200);
      const efficiencyWinner = sgflopsPerDollarUS === maxSGFLOPS ? 'U.S.' :
                               sgflopsPerDollarChina === maxSGFLOPS ? 'China (CM384)' : 'China (H200)';

      const maxSPFLOPS = Math.max(spflopsUS, spflopsChina, spflopsH200);
      const performanceWinner = spflopsUS === maxSPFLOPS ? 'U.S.' :
                                spflopsChina === maxSPFLOPS ? 'China (CM384)' : 'China (H200)';

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-8">
              <h1 className="text-5xl font-bold text-white mb-3">Data Center Performance & Cost Analysis</h1>
              <p className="text-gray-300 text-lg">3-Year Total Cost of Ownership: U.S. vs China (CM384) vs China (H200)</p>
              <p className="text-gray-400 text-sm mt-2">Using Sustainable PFLOPS (memory-limited at AI=200)</p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
              {/* Controls */}
              <div className="lg:col-span-1 bg-white rounded-lg shadow-2xl p-6">
                <h2 className="text-2xl font-bold mb-6 text-gray-800">Configuration</h2>

                <div className="mb-6 bg-indigo-50 p-4 rounded-lg">
                  <h3 className="text-lg font-semibold mb-4 text-indigo-900">Facility Size</h3>
                  <SliderControl
                    label="Power Capacity"
                    value={sizeMW}
                    onChange={setSizeMW}
                    min={100}
                    max={1000}
                    step={10}
                    unit=""
                    suffix=" MW"
                    icon="âš¡"
                    benchmarkValue={400}
                    benchmarkLabel="Benchmark: 400 MW"
                  />
                </div>

                <div className="mb-6 bg-purple-50 p-4 rounded-lg">
                  <h3 className="text-lg font-semibold mb-4 text-purple-900">Shared Parameters</h3>
                  <SliderControl
                    label="PUE"
                    value={pue}
                    onChange={setPue}
                    min={1.04}
                    max={1.20}
                    step={0.01}
                    unit=""
                    suffix=""
                    icon="âš¡"
                    benchmarkValue={1.11}
                    benchmarkLabel="Benchmark: 1.11"
                  />
                  <SliderControl
                    label="Utilization Rate"
                    value={utilization}
                    onChange={setUtilization}
                    min={40}
                    max={80}
                    step={5}
                    unit=""
                    suffix="%"
                    icon="ðŸ’»"
                    benchmarkValue={60}
                    benchmarkLabel="Benchmark: 60%"
                  />
                </div>

                <div className="mb-6 bg-blue-50 p-4 rounded-lg">
                  <h3 className="text-sm font-semibold mb-2 text-blue-900">ðŸ‡ºðŸ‡¸ U.S. Construction</h3>
                  <SliderControl
                    label=""
                    value={constructionCostUS}
                    onChange={setConstructionCostUS}
                    min={8}
                    max={12}
                    step={0.5}
                    unit="$"
                    suffix="M/MW"
                    benchmarkValue={10}
                    benchmarkLabel="$10M/MW"
                  />
                </div>

                <div className="bg-red-50 p-4 rounded-lg">
                  <h3 className="text-sm font-semibold mb-2 text-red-900">ðŸ‡¨ðŸ‡³ China Construction</h3>
                  <SliderControl
                    label=""
                    value={constructionCostChina}
                    onChange={setConstructionCostChina}
                    min={5.5}
                    max={6.5}
                    step={0.1}
                    unit="$"
                    suffix="M/MW"
                    benchmarkValue={6}
                    benchmarkLabel="$6M/MW"
                  />
                </div>
              </div>

              {/* Results */}
              <div className="lg:col-span-3 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <ResultCard
                    title="United States"
                    flag="ðŸ‡ºðŸ‡¸"
                    construction={constructionTotalUS}
                    hardware={hardwareCostUS}
                    electricity={electricityCostUS}
                    total={totalCostUS}
                    units={racksUS}
                    unitLabel="GB200 NVL72 racks"
                    spflops={spflopsUS}
                    spflopsPerUnit={calcSPFLOPS(hardware.gb200)}
                    sgflopsPerDollar={sgflopsPerDollarUS}
                    color="bg-gradient-to-br from-blue-100 to-blue-200 border-4 border-blue-400 shadow-xl"
                  />

                  <ResultCard
                    title="China (CM384)"
                    flag="ðŸ‡¨ðŸ‡³"
                    construction={constructionTotalChina}
                    hardware={hardwareCostChina}
                    electricity={electricityCostChina}
                    total={totalCostChina}
                    units={racksChina}
                    unitLabel="CloudMatrix 384 racks"
                    spflops={spflopsChina}
                    spflopsPerUnit={calcSPFLOPS(hardware.cm384)}
                    sgflopsPerDollar={sgflopsPerDollarChina}
                    color="bg-gradient-to-br from-red-100 to-red-200 border-4 border-red-400 shadow-xl"
                  />

                  <ResultCard
                    title="China (H200)"
                    flag="ðŸ‡¨ðŸ‡³"
                    construction={constructionTotalChina}
                    hardware={hardwareCostH200}
                    electricity={electricityCostChina}
                    total={totalCostH200}
                    units={podsH200}
                    unitLabel="DGX H200 pods"
                    spflops={spflopsH200}
                    spflopsPerUnit={calcSPFLOPS(hardware.h200pod)}
                    sgflopsPerDollar={sgflopsPerDollarH200}
                    color="bg-gradient-to-br from-green-100 to-green-200 border-4 border-green-400 shadow-xl"
                  />
                </div>

                <div className="bg-gradient-to-r from-yellow-200 via-orange-200 to-pink-200 p-6 rounded-lg shadow-2xl border-4 border-yellow-400">
                  <h3 className="text-2xl font-bold mb-6 text-center">Comparative Analysis</h3>

                  <div className="grid grid-cols-3 gap-4">
                    <div className="bg-white bg-opacity-70 p-4 rounded-lg text-center">
                      <h4 className="text-sm font-semibold text-gray-600 mb-2">Performance Winner</h4>
                      <p className="text-2xl font-bold text-indigo-800">{performanceWinner}</p>
                      <p className="text-lg font-semibold text-indigo-600">{formatNumber(maxSPFLOPS)} SPFLOPS</p>
                    </div>

                    <div className="bg-white bg-opacity-70 p-4 rounded-lg text-center">
                      <h4 className="text-sm font-semibold text-gray-600 mb-2">Efficiency Winner</h4>
                      <p className="text-2xl font-bold text-green-800">{efficiencyWinner}</p>
                      <p className="text-lg font-semibold text-green-600">{formatNumber(maxSGFLOPS)} SGFLOPS/$</p>
                    </div>

                    <div className="bg-white bg-opacity-70 p-4 rounded-lg text-center">
                      <h4 className="text-sm font-semibold text-gray-600 mb-2">Lowest Cost</h4>
                      <p className="text-2xl font-bold text-purple-800">
                        {totalCostChina <= totalCostUS && totalCostChina <= totalCostH200 ? 'China (CM384)' :
                         totalCostH200 <= totalCostUS ? 'China (H200)' : 'U.S.'}
                      </p>
                      <p className="text-lg font-semibold text-purple-600">
                        {formatCurrency(Math.min(totalCostUS, totalCostChina, totalCostH200))}
                      </p>
                    </div>
                  </div>

                  <div className="mt-4 bg-white bg-opacity-50 p-4 rounded-lg">
                    <h4 className="text-sm font-semibold text-gray-600 mb-2 text-center">Efficiency Comparison (vs U.S.)</h4>
                    <div className="grid grid-cols-2 gap-4 text-center">
                      <div>
                        <span className="text-sm text-gray-600">China (CM384):</span>
                        <span className={`ml-2 font-bold ${sgflopsPerDollarChina >= sgflopsPerDollarUS ? 'text-green-600' : 'text-red-600'}`}>
                          {sgflopsPerDollarChina >= sgflopsPerDollarUS ? '+' : ''}{(((sgflopsPerDollarChina / sgflopsPerDollarUS) - 1) * 100).toFixed(1)}%
                        </span>
                      </div>
                      <div>
                        <span className="text-sm text-gray-600">China (H200):</span>
                        <span className={`ml-2 font-bold ${sgflopsPerDollarH200 >= sgflopsPerDollarUS ? 'text-green-600' : 'text-red-600'}`}>
                          {sgflopsPerDollarH200 >= sgflopsPerDollarUS ? '+' : ''}{(((sgflopsPerDollarH200 / sgflopsPerDollarUS) - 1) * 100).toFixed(1)}%
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<DataCenterCompare />, document.getElementById('root'));
  </script>
</body>
</html>
